<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>BattleShip: Dashboard</title>
    <meta name="description" content="">

    <meta name="viewport" content="width=device-width">

    <link rel="stylesheet" href="../assets/css/bootstrap.css">
    <link rel="stylesheet" href="../assets/css/bootstrap-responsive.css">
    <link rel="stylesheet" href="../assets/css/jquery.fancybox.css">
    <link rel="stylesheet" href="../assets/css/style.css">

    <script src="../assets/js/jquery.js"></script>
    <link rel="stylesheet" type="text/css" href="gameboardStyle.css">
    <script src="SHIP_noneDebug.js"></script>


    <script>

        $(document).ready(function() {

            //on document load, set the body background to retina-wood.
            $('body').removeClass().addClass("retina-wood");


            $(".playButtonAction").click(function(e){
                console.log("Play button was pressed");
                console.log(e);

            });












            // by default the fire button should be disabled.
            $("#fireMissiles").attr("disabled", true);
            $("#fireMessage").html("");


// Array that will wrap the outgoing Rounds
            var wrapperData = new Array();


            function makeTargetSelections() {

                var outgoingRounds = new Array();
                var count = 0;

                $("table#targetCords td").click(function(e) {



                    console.log("Cell was clicked: ", $(this).attr('id'));

                    var cellClicked = $(this).attr('id');

                    if ($(this).hasClass("hit") || $(this).hasClass("missed") || $(this).hasClass("pending")) {
                        alert("You cannot click the same cell twice.");
                    } else {

                        if (count < 5) {
                            $(this).addClass('pending');
                            var ar = splitt(cellClicked);
                            var tmp = new Shot();
                            tmp.setCoords(ar[0], ar[1]);
                            outgoingRounds.push(tmp);
                            count++;
                        }

                        if (count === 5) {
                            wrapperData.push({"RoundType": "outgoing", "From": "player1", "To": "player2"});
                            wrapperData.push({"Rounds":outgoingRounds});

                            // 5 cords have been select, enable the fire button
                            $("#fireMissiles").attr("disabled", false);

                            // display the ready to fire Message
                            $("#fireMessage").html("<h3>Ready to Fire</h3>");
                        }

                    }

                });


            }


            function updateGridWithIncomingShots(jsonData) {
                // function accepts a json string of shots where the determination has been
                // made for whether or not it they we hit or misses

                var data = JSON.parse(jsonData);
                console.log(data);

                console.log(data.length);

                var IR = data[1].Rounds;
                console.log(IR);
                Object.keys(IR).forEach(function(key) {
                    var cord = IR[key].coords;
                    var classTOAdd = (IR[key].isHit === false) ? "missed" : "hit";
                    $("#" + cord).addClass(classTOAdd);
                    console.log(key, IR[key]);
                });

            }


            $("#fireMissiles").click(function() {

                console.log("goingRounds: ", wrapperData);

                if (wrapperData[1].Rounds.length === 5) {
                    //5 shots in fact have been select, thus valid
                    var dataInJSON = JSON.stringify(wrapperData);
                    console.log(dataInJSON);

                    // This data needs to be sent to the server, check whether or not the select shots were hits
                    // or misses

                    // Then the results from that check are then sent to both the send and the receive to update the
                    // grids

                    // The returned json results should then be passed to the updateGridWIthIncomingShots


                } else {
                    console.log("Error, 5 shots have not been select.  Invalid program state");
                }

            });


            makeTargetSelections();




            ///=========================================

            function l(e) { console.log(e); }

            var gameBoats = new Array();
            function submitShips() {
                //AJAX CALL to the back end will be made from this method.
                // from which the json data will be inserted into the table.


                console.log("FINAL RESULT: ");
                console.log(JSON.stringify(gameBoats));
                alert("Your Gameboard has been submitted to the server");

            }

            function startShipPlacement(boat) {
                var count = 1;
                $("Table#OceanCords td").click(function(e) {
                    var cellClicked = $(this).attr('id');
                    if ($(this).hasClass("clicked") || $(this).hasClass("disabled")) {
                        alert("You cannot click the same cell twice.");
                    } else {
                        if (count == 1) {
                            boat.shipCords_push(cellClicked);
                            $(this).addClass('clicked');
                            if (boat.shipCords.length == 1) {
                                boat.step1();
                            }
                            count++;
                        }
                        if (count == 2) {
                            if ($(this).hasClass("gr")) {
                                boat.shipCords_push(cellClicked);
                                boat.removePotentialEndsColoring();
                                $(this).addClass('clicked');
                                boat.fillInShip();
                                count++;
                            }
                        }
                        if (count === 3) {
                            //the ship has been built
                            $("#message").html(boat.getName() + " has been built.");
                            $('Table#OceanCords td').off('click');
                            $(this).trigger("SecondShip");
                        }
                    }
                });
            }

            $("Table#OceanCords td").on("SecondShip", function() {
                var boat = new Ship("Destroyer", 4);
                gameBoats.push(boat);
                var count = 1;
                $("Table#OceanCords td").click(function(e) {
                    var cellClicked = $(this).attr('id');
                    if ($(this).hasClass("clicked") || $(this).hasClass("disabled")) {
                        alert("You cannot click the same cell twice.");
                    } else {
                        if (count == 1) {
                            boat.shipCords_push(cellClicked);
                            $(this).addClass('clicked');
                            if (boat.shipCords.length == 1) {
                                boat.step1();
                            }
                            count++;
                        }
                        if (count == 2) {
                            if ($(this).hasClass("gr")) {
                                boat.shipCords_push(cellClicked);
                                boat.removePotentialEndsColoring();
                                $(this).addClass('clicked');
                                boat.fillInShip();
                                count++;
                            }
                        }
                        if (count === 3) {
                            //the ship has been built
                            $("#message").append(", " + boat.getName() + " has been built.");
                            $('Table#OceanCords td').off('click');
                            $(this).trigger("ThirdShip");
                        }
                    }
                });
            });

            $("Table#OceanCords td").on("ThirdShip", function() {
                var boat = new Ship("Cruiser", 3);
                gameBoats.push(boat);
                var count = 1;
                $("Table#OceanCords td").click(function(e) {
                    var cellClicked = $(this).attr('id');
                    if ($(this).hasClass("clicked") || $(this).hasClass("disabled")) {
                        alert("You cannot click the same cell twice.");
                    } else {
                        if (count == 1) {
                            boat.shipCords_push(cellClicked);
                            $(this).addClass('clicked');
                            if (boat.shipCords.length == 1) {
                                boat.step1();
                            }
                            count++;
                        }
                        if (count == 2) {
                            if ($(this).hasClass("gr")) {
                                boat.shipCords_push(cellClicked);
                                boat.removePotentialEndsColoring();
                                $(this).addClass('clicked');
                                boat.fillInShip();
                                count++;
                            }
                        }
                        if (count === 3) {
                            //the ship has been built
                            $("#message").append(", " + boat.getName() + " has been built.");
                            $('Table#OceanCords td').off('click');
                            submitShips();
                        }
                    }
                });
            });


            var carrier = new Ship("Carrier", 5);

            gameBoats.push(carrier);

            startShipPlacement(carrier);



        });
    </script>

</head>
<body>


<div class="topbar">
    <div class="container-fluid">
        <a href="dashboard.html" class='company'>BattleShip: Dashboard</a>

        <ul class='mini'>
            <li>
                <a href="index.html">
                    <img src="../assets/img/icons/fugue/control-power.png" alt="">
                    Logout
                </a>
            </li>
        </ul>
    </div>
</div>

<div class="main">
    <div class="container-fluid">

        <div class="content">

            <div class="row-fluid">
                <div class="span5" style="background-color: blue;">

                    <h2>Count Clock goes here</h2>

                </div>
            </div>

            <div class="row-fluid">
                <div class="span12">
                    <div class="box">
                        <div class="box-head">
                            <h3>Target Grid</h3>
                        </div>
                        <div class="box-content">

                        <div id="gameBox">
                        <table border="1" id="targetCords">
                        <tr>
                            <th id="00"></th>

                            <th id="01">1</th>

                            <th id="02">2</th>

                            <th id="03">3</th>

                            <th id="04">4</th>

                            <th id="05">5</th>

                            <th id="06">6</th>

                            <th id="07">7</th>

                            <th id="08">8</th>

                            <th id="09">9</th>

                            <th id="010">10</th>
                        </tr>
                        <tr>
                            <th id="A0">A</th>

                            <td id="A1"></td>

                            <td id="A2"></td>

                            <td id="A3"></td>

                            <td id="A4"></td>

                            <td id="A5"></td>

                            <td id="A6"></td>

                            <td id="A7"></td>

                            <td id="A8"></td>

                            <td id="A9"></td>

                            <td id="A10"></td>
                        </tr>


                        <tr>
                            <th id="B0">B</th>

                            <td id="B1"></td>

                            <td id="B2"></td>

                            <td id="B3"></td>

                            <td id="B4"></td>

                            <td id="B5"></td>

                            <td id="B6"></td>

                            <td id="B7"></td>

                            <td id="B8"></td>

                            <td id="B9"></td>

                            <td id="B10"></td>
                        </tr>



                        <tr>
                            <th id="C0">C</th>

                            <td id="C1"></td>

                            <td id="C2"></td>

                            <td id="C3"></td>

                            <td id="C4"></td>

                            <td id="C5"></td>

                            <td id="C6"></td>

                            <td id="C7"></td>

                            <td id="C8"></td>

                            <td id="C9"></td>

                            <td id="C10"></td>
                        </tr>



                        <tr>
                            <th id="D0">D</th>

                            <td id="D1"></td>

                            <td id="D2"></td>

                            <td id="D3"></td>

                            <td id="D4"></td>

                            <td id="D5"></td>

                            <td id="D6"></td>

                            <td id="D7"></td>

                            <td id="D8"></td>

                            <td id="D9"></td>

                            <td id="D10"></td>
                        </tr>



                        <tr>
                            <th id="E0">E</th>

                            <td id="E1"></td>

                            <td id="E2"></td>

                            <td id="E3"></td>

                            <td id="E4"></td>

                            <td id="E5"></td>

                            <td id="E6"></td>

                            <td id="E7"></td>

                            <td id="E8"></td>

                            <td id="E9"></td>

                            <td id="E10"></td>
                        </tr>


                        <tr>
                            <th id="F0">F</th>

                            <td id="F1"></td>

                            <td id="F2"></td>

                            <td id="F3"></td>

                            <td id="F4"></td>

                            <td id="F5"></td>

                            <td id="F6"></td>

                            <td id="F7"></td>

                            <td id="F8"></td>

                            <td id="F9"></td>

                            <td id="F10"></td>
                        </tr>



                        <tr>
                            <th id="G0">G</th>

                            <td id="G1"></td>

                            <td id="G2"></td>

                            <td id="G3"></td>

                            <td id="G4"></td>

                            <td id="G5"></td>

                            <td id="G6"></td>

                            <td id="G7"></td>

                            <td id="G8"></td>

                            <td id="G9"></td>

                            <td id="G10"></td>
                        </tr>



                        <tr>
                            <th id="H0">H</th>

                            <td id="H1"></td>

                            <td id="H2"></td>

                            <td id="H3"></td>

                            <td id="H4"></td>

                            <td id="H5"></td>

                            <td id="H6"></td>

                            <td id="H7"></td>

                            <td id="H8"></td>

                            <td id="H9"></td>

                            <td id="H10"></td>
                        </tr>



                        <tr>
                            <th id="I0">I</th>

                            <td id="I1"></td>

                            <td id="I2"></td>

                            <td id="I3"></td>

                            <td id="I4"></td>

                            <td id="I5"></td>

                            <td id="I6"></td>

                            <td id="I7"></td>

                            <td id="I8"></td>

                            <td id="I9"></td>

                            <td id="I10"></td>
                        </tr>



                        <tr>
                            <th id="J0">J</th>

                            <td id="J1"></td>

                            <td id="J2"></td>

                            <td id="J3"></td>

                            <td id="J4"></td>

                            <td id="J5"></td>

                            <td id="J6"></td>

                            <td id="J7"></td>

                            <td id="J8"></td>

                            <td id="J9"></td>

                            <td id="J10"></td>
                        </tr>




                        </table>

                        <br/>

                        <button id="fireMissiles">Fire</button>

                        <br/>
                        <h3 id="fireMessage"></h3>


                        </div>

                        Select 5 boxes on which you wish to fire upon.  Upon selecting 5 boxes, the "Fire" button will be enabled


                        </div>
                    </div>
                </div>
            </div>

            <div class="row-fluid">
                <div class="span12">
                    <div class="box">
                        <div class="box-head">
                            <h3>Ocean Grid</h3>
                        </div>
                        <div class="box-content">



                        <div class="row-fluid">
                            <div class="span8">
                            <div id="gameBox">
                            <table border="1" id="OceanCords">
                            <tr>
                                <th id="00"></th>

                                <th id="01">1</th>

                                <th id="02">2</th>

                                <th id="03">3</th>

                                <th id="04">4</th>

                                <th id="05">5</th>

                                <th id="06">6</th>

                                <th id="07">7</th>

                                <th id="08">8</th>

                                <th id="09">9</th>

                                <th id="010">10</th>
                            </tr>
                            <tr>
                                <th id="A0">A</th>

                                <td id="A1"></td>

                                <td id="A2"></td>

                                <td id="A3"></td>

                                <td id="A4"></td>

                                <td id="A5"></td>

                                <td id="A6"></td>

                                <td id="A7"></td>

                                <td id="A8"></td>

                                <td id="A9"></td>

                                <td id="A10"></td>
                            </tr>


                            <tr>
                                <th id="B0">B</th>

                                <td id="B1"></td>

                                <td id="B2"></td>

                                <td id="B3"></td>

                                <td id="B4"></td>

                                <td id="B5"></td>

                                <td id="B6"></td>

                                <td id="B7"></td>

                                <td id="B8"></td>

                                <td id="B9"></td>

                                <td id="B10"></td>
                            </tr>



                            <tr>
                                <th id="C0">C</th>

                                <td id="C1"></td>

                                <td id="C2"></td>

                                <td id="C3"></td>

                                <td id="C4"></td>

                                <td id="C5"></td>

                                <td id="C6"></td>

                                <td id="C7"></td>

                                <td id="C8"></td>

                                <td id="C9"></td>

                                <td id="C10"></td>
                            </tr>



                            <tr>
                                <th id="D0">D</th>

                                <td id="D1"></td>

                                <td id="D2"></td>

                                <td id="D3"></td>

                                <td id="D4"></td>

                                <td id="D5"></td>

                                <td id="D6"></td>

                                <td id="D7"></td>

                                <td id="D8"></td>

                                <td id="D9"></td>

                                <td id="D10"></td>
                            </tr>



                            <tr>
                                <th id="E0">E</th>

                                <td id="E1"></td>

                                <td id="E2"></td>

                                <td id="E3"></td>

                                <td id="E4"></td>

                                <td id="E5"></td>

                                <td id="E6"></td>

                                <td id="E7"></td>

                                <td id="E8"></td>

                                <td id="E9"></td>

                                <td id="E10"></td>
                            </tr>


                            <tr>
                                <th id="F0">F</th>

                                <td id="F1"></td>

                                <td id="F2"></td>

                                <td id="F3"></td>

                                <td id="F4"></td>

                                <td id="F5"></td>

                                <td id="F6"></td>

                                <td id="F7"></td>

                                <td id="F8"></td>

                                <td id="F9"></td>

                                <td id="F10"></td>
                            </tr>



                            <tr>
                                <th id="G0">G</th>

                                <td id="G1"></td>

                                <td id="G2"></td>

                                <td id="G3"></td>

                                <td id="G4"></td>

                                <td id="G5"></td>

                                <td id="G6"></td>

                                <td id="G7"></td>

                                <td id="G8"></td>

                                <td id="G9"></td>

                                <td id="G10"></td>
                            </tr>



                            <tr>
                                <th id="H0">H</th>

                                <td id="H1"></td>

                                <td id="H2"></td>

                                <td id="H3"></td>

                                <td id="H4"></td>

                                <td id="H5"></td>

                                <td id="H6"></td>

                                <td id="H7"></td>

                                <td id="H8"></td>

                                <td id="H9"></td>

                                <td id="H10"></td>
                            </tr>



                            <tr>
                                <th id="I0">I</th>

                                <td id="I1"></td>

                                <td id="I2"></td>

                                <td id="I3"></td>

                                <td id="I4"></td>

                                <td id="I5"></td>

                                <td id="I6"></td>

                                <td id="I7"></td>

                                <td id="I8"></td>

                                <td id="I9"></td>

                                <td id="I10"></td>
                            </tr>



                            <tr>
                                <th id="J0">J</th>

                                <td id="J1"></td>

                                <td id="J2"></td>

                                <td id="J3"></td>

                                <td id="J4"></td>

                                <td id="J5"></td>

                                <td id="J6"></td>

                                <td id="J7"></td>

                                <td id="J8"></td>

                                <td id="J9"></td>

                                <td id="J10"></td>
                            </tr>




                            </table>

                            <br/>
                            <h3 id="message">You should start building some ships</h3>


                            </div>

                            </div>
                            <div class="span4">
                                <h3>Game Instructions go Here</h3>
                                <p>Just Click a box to get started. The order and size of each
                                ship are as follows: Aircraft Carrier: 5 boxes, Destroyer: 4 boxes, Cruiser: 3 boxes.</p>

                                <p>Once you click your first square, the green boxes that appear are the possible ending
                                points of the ship.  Once your click on the green box, the boxes in between the two points
                                will automatically be filled in.  <b>Once you have created your three ships, the your ships
                                will automatically be persisted to the server.</b></p>

                             <br/><br/><br/>

                                <div class="colorGuide">
                                    <h3>Color Guide</h3>
                                    <p>Hit: RED</p>
                                    <p>Miss: WHITE</p>
                                    <p>Ship: GRAY</p>
                                </div>

                            </div>
                        </div>




                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<script src="../assets/js/less.js"></script>
<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/jquery.peity.js"></script>
<script src="../assets/js/jquery.fancybox.js"></script>
<script src="../assets/js/jquery.flot.js"></script>
<script src="../assets/js/jquery.color.js"></script>
<script src="../assets/js/jquery.flot.resize.js"></script>
<script src="../assets/js/jquery.cookie.js"></script>
<script src="../assets/js/jquery.cookie.js"></script>
<script src="../assets/js/custom.js"></script><script src="js/demo.js"></script>
</body>
</html>